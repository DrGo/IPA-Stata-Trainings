{smcl}
{txt}{...}
{pstd}{c TLC}{hline 43}{c TRC}{break}
{bf}{...}
{c |}{view `""Post Kenya 2014 - Stata 102.smcl""': Innovations for Poverty Action{space 12}}{c |}{break}
{c |}{view `""Post Kenya 2014 - Stata 102.smcl""': The Abdul Latif Jameel Poverty Action Lab{space 1}}{c |}{break}
{c |}{view `""Post Kenya 2014 - Stata 102.smcl""':{space 43}}{c |}{break}
{c |}{view `""Post Kenya 2014 - Stata 102.smcl""': Staff Training - Kenya 2014 {space 14}}{c |}{break}
{c |}{view `""Post Kenya 2014 - Stata 102.smcl""': Stata 102{space 33}}{c |}{break}
{sf}{...}
{c BLC}{hline 43}{c BRC}

{pstd}{bf:Loops}{break}

{pstd}{bf:{stata `"use "Raw/Post Kenya 2014 - Stata 102", clear"'}}{p_end}

{pstd}{view `""SMCL/Concepts/Loops.smcl"##introduction"':1. Introduction}{break}
{view `""SMCL/Concepts/Loops.smcl"##foreach"':2. The Foreach Command}{break}
{view `""SMCL/Concepts/Loops.smcl"##writing"':3. Writing a Loop}{break}
{view `""SMCL/Concepts/Loops.smcl"##examples"':4. Loop Examples}{break}

{hline}{marker introduction}

{pstd}{bf:1. Introduction}

{hline}

{pstd}In Stata, loops are used to repeat a command multiple times or to execute
a series of commands that are related. There are several commands that work as loops;
{cmd:foreach} is by far the most widely used, so we will focus on it in this module.
Once you understand the syntax of one of the type of loops, you can learn any of them easily.

{hline}{marker foreach}

{pstd}{bf:2. The Foreach Command}

{hline}

{pstd}The most basic {cmd:foreach} syntax runs in the following way:

{pstd}{cmd}{...}
foreach {it:item} in list_item1 list_item2 list_item3 {{break}
{p_end}{pmore}command `item'{break}{p_end}{pstd}
}
{txt}{sf}{ul off}{...}

{pstd}where {it:item} is the {view `""SMCL/Concepts/Macros and Locals.smcl""':local macro} that is used to signify each item of the list.
So, as Stata loops through the command for each item on the list, it will
substitute each list_item into the macro, performing the following:

{pstd}{cmd}{...}
command list_item1{break}
command list_item2{break}
command list_item3
{txt}{sf}{ul off}{...}

{pstd}For example, execute the following loop:

{pstd}{cmd}foreach letter in a b c d {{txt}{p_end}
{pmore}{cmd}display "`letter'"{txt}{p_end}
{pstd}{cmd}}{txt}{p_end}

{pstd}{stata `"run "Do/Concepts/Loops.do" 1"':Click here to execute.}

{pstd}Does this output make sense? Here, the command is {cmd:display},
a b c d is the list of items we want to loop over, and {it:letter} is
the local macro we want to use to first declare and then call the list.

{pstd}{bf:Note:} the opening bracket { has to come at the end of
the line where the list is declared, and the closing bracket } comes
on a line by itself once the loop is complete.

{pstd}Why did Stata output these letters on separate lines? The {cmd:foreach}
command repeatedly sets the local macro `letter' to each element in the list
that follows {bf:in}, executing the commands in the loop for each value
of `letter'. {it:letter} is an arbitrary name, another could have been chosen
and the output of the loop would have been identical.

{marker whats_in_a_name}{...}
{p2colset 5 84 0 0}{...}
{pstd}{c TLC}{hline 78}{c TRC}{p_end}
{p2col:{c |} {it:Technical Tip!}}{c |}{p_end}
{pstd}{c LT}{hline 78}{c RT}{p_end}
{p2col:{c |} {bf:What's in a name?}}{c |}{p_end}
{pstd}{c LT}{hline 78}{c RT}{p_end}
{p2col:{c |} The same rules generally apply to all Stata names, whether it's of a}{c |}{p_end}
{p2col:{c |} variable, macro, or something else. From {helpb varname:help varname}:}{c |}{p_end}
{p2col:{c |} }{c |}{p_end}
{p2col:{c |} "Variable names may be 1 to 32 characters long and must start with {cmd:a-z}, {cmd:A-Z},}{c |}{p_end}
{p2col:{c |} or {cmd:_}, and the remaining characters may be {cmd:a-z}, {cmd:A-Z}, {cmd:_}, or {cmd:0-9}."}{c |}{p_end}
{p2col:{c |} }{c |}{p_end}
{p2col:{c |} The exception to this rule is local macros, which may be 1 to 31 characters}{c |}{p_end}
{p2col:{c |} long (a character shorter), but may start with {cmd:0-9}.}{c |}{p_end}
{pstd}{c BLC}{hline 78}{c BRC}{p_end}
{p2colreset}{...}

{hline}{marker writing}

{pstd}{bf:3. Writing a Loop}

{hline}

{pstd}Imagine we want to write a loop that tabulates 3 variables in our dataset,
say, {bf:literateyn}, {bf:own4wheeleryn}, and {bf:theftfromcaryn}. How might
we go about doing so? We'll introduce here a handy way to go about
writing loops. This process is certainly not a must: the loop we're creating
here is relatively simple, and people write their loops in different ways,
nonetheless, it should prove useful.

{pstd}First write the command as it would be for the first variable in the loop.
In this case:

{pstd}{cmd}{...}
tabulate literateyn
{txt}{sf}{ul off}{...}

{pstd}Them, we write the loop around it:

{pstd}{cmd}{...}
foreach _ in ___ {{break}
{p_end}{pmore}tabulate literateyn{break}{p_end}{pstd}
}
{txt}{sf}{ul off}{...}

{pstd}Now, you should see where literateyn and the other list variables should
be placed:

{pstd}{cmd}{...}
foreach _ in literateyn own4wheeleryn theftfromcaryn {{break}
{p_end}{pmore}tabulate literateyn{break}{p_end}{pstd}
}
{txt}{sf}{ul off}{...}

{pstd}Finally, come up with a name for the local and insert it into the
{view `""SMCL/Concepts/Macros and Locals.smcl"##declaring"':declaration} and calling parts of the loop:

{pstd}{cmd}foreach var in literateyn own4wheeleryn theftfromcaryn {{txt}{p_end}
{pmore}{cmd}tabulate `var'{txt}{p_end}
{pstd}{cmd}}{txt}{p_end}

{pstd}{stata `"run "Do/Concepts/Loops.do" 2"':Click here to execute.}

{pstd}Remember the importance of putting single quotes around a local macro,
in this case, {bf:var}, when it is being {view `""SMCL/Concepts/Macros and Locals.smcl"##declaring"':called}.

{pstd}Also a quick note about style: notice that the code was indented on the line following
the left brace ({) while the right brace (}) stays aligned with {cmd:foreach}. This formatting
makes the code more readable; it's easy to tell what's in the loop and what's not.
This is an important practice to adopt, especially when using more complex constructions
such as loops within loops.


{hline}

{pstd}Next: {view `""SMCL/Tasks/Importing.smcl""':Importing}{break}
Previous: {view `""SMCL/Concepts/Macros and Locals.smcl""':Macros and Locals}{break}
{view `""Post Kenya 2014 - Stata 102.smcl""':Stata 102 Start}{break}
